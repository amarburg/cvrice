# Makefile auto-Generated by mkrf
#  DO NOT EDIT, contents may be replaced without warning 
#
require 'rake/clean'

CLEAN.include('*.o')
CLOBBER.include('libopencv_rice.so', 'mkrf.log')

SRC = FileList['opencv_rice.cpp','core/*.cpp','highgui/highgui.cpp','nonfree/nonfree.cpp','nonfree/sift.cpp']
OBJ = SRC.ext('o')
CC = 'gcc'
CPP = 'g++'

ADDITIONAL_OBJECTS = '-L/home/aaron/.rvm/gems/ruby-2.1.0/gems/rice-1.6.0/ruby/lib/lib -lrice -lstdc++ -lopencv_core -lopencv_features2d -lopencv_highgui -lopencv_nonfree'

LDSHARED = "gcc -shared "

LIBPATH =  "-L/home/aaron/.rvm/rubies/ruby-2.1.0/lib "

INCLUDES = "-I/home/aaron/.rvm/rubies/ruby-2.1.0/include/ruby-2.1.0 -I/home/aaron/.rvm/rubies/ruby-2.1.0/include/ruby-2.1.0/x86_64-linux -I/home/aaron/.rvm/rubies/ruby-2.1.0/lib/ruby/2.1.0/x86_64-linux -I/home/aaron/.rvm/rubies/ruby-2.1.0/lib/ruby/site_ruby/2.1.0 -I."

LIBS = "-lpthread -ldl -lcrypt -lm"

CFLAGS = "-fPIC  -O3 -fno-fast-math -ggdb3 -Wall -Wextra -Wno-unused-parameter -Wno-parentheses -Wno-long-long -Wno-missing-field-initializers -Wunused-variable -Wpointer-arith -Wwrite-strings -Wdeclaration-after-statement -Wimplicit-function-declaration  -fPIC -ggdb -O0 -fPIC -I/home/aaron/.rvm/gems/ruby-2.1.0/gems/rice-1.6.0/ruby/lib/include "

RUBYARCHDIR = "#{ENV["RUBYARCHDIR"]}"
LIBRUBYARG_SHARED = "-Wl,-R -Wl,/home/aaron/.rvm/rubies/ruby-2.1.0/lib -L/home/aaron/.rvm/rubies/ruby-2.1.0/lib -lruby"

task :default => :libopencv_rice

task :libopencv_rice => ['Rakefile','libopencv_rice.so']

rule '.o' => '.c' do |t|
  sh "#{CC} #{CFLAGS} #{INCLUDES} -o #{t.name} -c #{t.source}"
end

rule '.o' => '.cpp' do |t|
  sh "#{CPP} #{CFLAGS} #{INCLUDES} -o #{t.name} -c #{t.source}"
end

desc "Build this extension"
file 'libopencv_rice.so' => OBJ do
  sh "#{LDSHARED} #{LIBPATH} -o libopencv_rice.so #{OBJ} #{ADDITIONAL_OBJECTS} #{LIBS} #{LIBRUBYARG_SHARED}"
end

desc "Rebuild rakefile"
file 'Rakefile' => 'mkrf_conf.rb' do |t|
  ruby 'mkrf_conf.rb'
end

desc "Install this extension"
task :install => 'libopencv_rice.so' do
  makedirs "#{RUBYARCHDIR}"
  install "libopencv_rice.so", "#{RUBYARCHDIR}"
end


